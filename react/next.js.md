# Next.js

### &#x20;原理

Next.js 的 SSR 是通过 Node.js 环境来实现的，基本流程如下：

1. **请求处理**\
   当浏览器请求一个页面时，Next.js 的服务器（通常是基于 Node.js）会接收到该请求。
2. **数据预取**\
   如果页面中定义了数据获取方法（如 `getServerSideProps`），Next.js 会在服务器端先执行这个函数，从而获取页面需要的初始数据。
3. **服务器渲染**\
   服务器使用 React 内置的 `ReactDOMServer.renderToString`（或 `renderToNodeStream` 等 API）将 React 组件树渲染为 HTML 字符串。这个过程会利用预先获取的数据填充组件内容。
4. **发送 HTML**\
   渲染好的 HTML 会作为响应返回给浏览器，用户可以立即看到预渲染的内容。
5. **客户端水合（Hydration）**\
   浏览器接收到 HTML 后，加载 React 客户端代码，并调用 `React.hydrate` <mark style="color:red;">将静态 HTML 转变为可交互的 React 应用</mark>。此时，客户端会重新绑定事件监听器，完成整个交互系统的建立。

Next.js 在 React 的基础上构建，提供了完整的开发框架。它包括：

* **文件系统路由**：只需在 `pages` 文件夹中创建文件，Next.js 就会自动为你生成路由。
* **服务器端渲染（SSR）**：可以在服务器上预先渲染页面，提高首屏加载速度和 SEO。
* **静态生成（SSG）**：支持在构建时预生成页面。
* **混合渲染**：允许在同一个项目中混合使用 SSR、SSG 和客户端渲染。
* **API 路由**：在同一个项目中构建后端 API，无需额外搭建服务器。\


### getStaticProps

* **执行时机**：在构建时（build time）执行，生成静态页面。
* **适用场景**：适用于内容不经常变化的页面，比如博客文章、营销页面等。
* **性能**：由于页面是静态生成的，加载速度非常快，并且可以被 CDN 缓存。
* **更新策略**：如果需要更新数据，可以结合增量静态再生（ISR），设置 `revalidate` 时间，让页面在后台重新生成。

***

### getServerSideProps

* **执行时机**：在每次请求时都在服务器上执行，生成页面。
* **适用场景**：适用于数据实时性要求高的页面，比如用户仪表盘、个性化内容页面等。
* **性能**：每次请求都需要等待数据获取和页面渲染，响应时间可能稍长，服务器压力也较高。
* **更新策略**：数据总是最新的，因为每次请求都会重新获取。

### Hydration&#x20;

是指在服务器端渲染（SSR）后，浏览器加载客户端 JavaScript 时，将静态生成的 HTML “激活”为可交互的页面过程。也就是说，React 在服务器上生成的 HTML 会在客户端通过 hydration 被“绑定”上事件处理器和内部状态，从而变成一个完整的 React 应用。
