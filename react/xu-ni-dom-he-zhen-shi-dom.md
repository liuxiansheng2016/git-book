# 虚拟dom和真实dom

虚拟 DOM 不会进行排版与重绘操作，而真实 DOM 会频繁重排与重绘

虚拟 DOM 的总损耗是“虚拟 DOM 增删改+真实 DOM 差异增删改+排版与重绘”，真实 DOM 的总损耗是“真实 DOM 完全增删改+排版与重绘”

&#x20;

   Real DOM vs Virtual DOM

    |           Real DOM           |       Virtual DOM        |
    | :--------------------------: | :----------------------: |
    |           更新较慢           |         更新较快         |
    |      可以直接更新 HTML       |    无法直接更新 HTML     |
    | 如果元素更新，则创建新的 DOM | 如果元素更新，则更新 JSX |
    |       DOM 操作非常昂贵       |     DOM 操作非常简单     |
    |        较多的内存浪费        |       没有内存浪费       |

使用虚拟 DOM 的

### 优势如下：

1\. 减少 DOM 操作

直接操作真实的 DOM 是昂贵的操作，因为每次操作都会引起重排（reflow）和重绘（repaint），导致性能下降。虚拟 DOM 可以在内存中进行操作，然后一次性同步到真实 DOM，减少了不必要的重排和重绘。

2\. 提高性能

虚拟 DOM 可以通过高效的 Diff 算法（如 React 的 Diff 算法）找出最小的更新集，从而减少实际 DOM 的更新次数，提高渲染效率。

3.易于调试

虚拟 DOM 是 JavaScript 对象，可以在开发工具中更容易地查看和调试。

4.跨平台

虚拟 DOM 提供了一种统一的表示形式，使得开发者可以在不同的平台上（如 Web、Native）使用相同的 API。

5.易于单元测试

虚拟 DOM 可以在没有实际 DOM 环境的情况下进行单元测试，因为它是纯 JavaScript 对象。

6.延迟渲染

虚拟 DOM 可以延迟渲染，直到需要时才真正更新到 DOM 中，这样可以避免不必要的渲染。

### 缺点：

1.内存消耗:

维护虚拟 DOM 需要额外的内存开销，尤其是对于大型应用而言。虚拟 DOM 的大小与实际 DOM 的大小成正比，因此可能会增加内存使用量。

2.Diff 算法的复杂性

虚拟 DOM 的 Diff 算法本身也是复杂的操作，特别是在大数据集的情况下，Diff 算法可能会变得非常耗时。

3.初始化成本

创建虚拟 DOM 和执行 Diff 算法都有一定的初始化成本，这在初次渲染时可能会导致性能下降。

4.过度优化

虚拟 DOM 试图优化每一次的 DOM 更新，但在某些情况下，直接操作 DOM 可能更加简单和高效。过度依赖虚拟 DOM 可能会导致不必要的复杂性。

### &#x20;React JSX转换成真实DOM过程？

#### JSX 编译

```
const element = <h1>Hello, world!</h1>;
```

将被编译为：

```
const element = React.createElement('h1', null, 'Hello, world!')
```

* 使用编译工具将 JSX 转换为 `React.createElement` 调用。
* `React.createElement` 创建 React 元素（普通 JavaScript 对象）。
* React 元素构建虚拟 DOM 树。
* 状态或属性变化时，React 进行调和过程（Diff 算法），计算虚拟 DOM 之间的差异。
* 根据差异生成最小化的更新操作，应用到真实 DOM 上。
* 浏览器渲染更新后的真实 DOM。
