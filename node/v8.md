# V8

V8 的内存主要分为两个部分：堆（Heap）和栈（Stack）。

## **栈（Stack）**

* 局部变量：函数调用时，局部变量和函数参数存储在栈中。
* 调用栈：函数调用的上下文信息（如调用者、返回地址等）也存储在栈中。
* 生命周期：栈中的数据在函数调用结束后自动释放。

## &#x20;**堆（Heap）**

* 对象：JavaScript 对象（包括数组、函数等）存储在堆中。
* 动态分配：堆中的内存是动态分配的，对象的生命周期由垃圾回收器管理。
* 垃圾回收：V8 使用垃圾回收算法来自动管理堆内存，释放不再使用的对象**2. 堆内存管理**

## &#x20;**堆的分区**

V8 的堆内存分为几个区域，主要包括：

* 新生代（Young Generation）：
  * Eden 空间：新创建的对象首先分配到这里。
  * Survivor 空间：经历第一次垃圾回收后仍然存活的对象会被移动到这里。
* 老生代（Old Generation）：
  * 老生代空间：长期存活的对象会被移动到这里。

## **V8 的垃圾回收机制**

V8 主要使用以下几种垃圾回收算法来管理内存：

1. &#x20;**Mark-Sweep（标记-清除）**

标记：从根对象开始，递归地标记所有可达对象。

清除：回收未被标记的对象。

优点：能够处理循环引用。

缺点：会产生内存碎片。

2. **Mark-Compact（标记-压缩）**

标记：与 Mark-Sweep 相同，从根对象开始，递归地标记所有可达对象。

压缩：在清除未被标记的对象后，将存活的对象移动到连续的内存区域，以减少内存碎片。

优点：既能处理循环引用，又能减少内存碎片。

3. **Generational Garbage Collection（分代垃圾回收）**

新生代（Young Generation）：

Scavenge：使用半空间复制（Copying）算法，将 Eden 空间和 Survivor 空间中的存活对象复制到另一个 Survivor 空间。

老生代（Old Generation）：

Mark-Sweep 或 Mark-Compact：处理长期存活的对象，使用标记-清除或标记-压缩算法。

## **V8 内存限制**

1. &#x20;浏览器环境

在浏览器中，每个标签页或 iframe 都有自己的 V8 实例，因此每个实例都有自己的内存限制。具体限制因浏览器而异，但通常如下：

Chrome：

32 位系统：每个标签页大约有 512MB 的堆内存限制。

64 位系统：每个标签页大约有 1.4GB 的堆内存限制。

2. Node.js 环境

在 Node.js 中，可以通过命令行参数来调整 V8 的内存限制。默认情况下，Node.js 的内存限制如下：

32 位系统：

堆内存：默认为 512MB。

64 位系统：

堆内存：默认为 1.4GB。
