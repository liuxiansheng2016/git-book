# é—®é¢˜

### **æ•è·é”™è¯¯**

#### **ç»„ä»¶å†…å¤„ç†**ï¼š

åœ¨ç»„ä»¶ä¸­ä½¿ç”¨ `try...catch` å—æˆ–åœ¨ `Observable` çš„ `subscribe` æ–¹æ³•ä¸­å¤„ç†é”™è¯¯ã€‚

#### **å…¨å±€æ•è·é”™è¯¯**

1. **window.onerror**
2. åˆ›å»ºä¸€ä¸ªå®ç° `ErrorHandler` æ¥å£çš„å…¨å±€é”™è¯¯å¤„ç†å™¨ç±»ï¼Œå¹¶åœ¨æ ¹æ¨¡å—ä¸­æä¾›è¯¥ç±»ã€‚

```
import { ErrorHandler, Injectable } from '@angular/core';

@Injectable()
export class GlobalErrorHandler implements ErrorHandler {
  handleError(error: any) {
    console.error('Global error:', error);
    // å¯ä»¥åœ¨è¿™é‡Œæ·»åŠ æ›´å¤šçš„é”™è¯¯å¤„ç†é€»è¾‘ï¼Œå¦‚å‘é€é”™è¯¯æŠ¥å‘Šåˆ°æœåŠ¡å™¨
  }
}
```

```
import { NgModule } from '@angular/core';
import { GlobalErrorHandler } from './global - error - handler';

@NgModule({
  providers: [
    { provide: ErrorHandler, useClass: GlobalErrorHandler }
  ]
})
export class AppModule { }
```

### åœ¨ Angular ä¸­ä¼˜åŒ–æ€§èƒ½

Angular åº”ç”¨ç¨‹åºçš„æ€§èƒ½ä¼˜åŒ–å¯ä»¥ä»å¤šä¸ªæ–¹é¢å…¥æ‰‹ï¼Œä¸‹é¢åˆ—å‡ºäº†ä¸€äº›å¸¸è§çš„ç­–ç•¥ï¼š

1. **ä½¿ç”¨ OnPush å˜æ›´æ£€æµ‹ç­–ç•¥**ï¼šé»˜è®¤æƒ…å†µä¸‹ï¼ŒAngular çš„å˜æ›´æ£€æµ‹æœºåˆ¶ä¼šæ£€æŸ¥æ‰€æœ‰ç»‘å®šçš„æ•°æ®æ˜¯å¦å‘ç”Ÿå˜åŒ–ã€‚é‡‡ç”¨ `OnPush` ç­–ç•¥å¯ä»¥å‡å°‘ä¸å¿…è¦çš„å˜æ›´æ£€æµ‹ï¼Œæé«˜æ€§èƒ½
2. **æ‡’åŠ è½½æ¨¡å—**ï¼šåˆ©ç”¨ Angular çš„æ‡’åŠ è½½ç‰¹æ€§ï¼Œå¯ä»¥åœ¨ç”¨æˆ·è®¿é—®ç‰¹å®šè·¯ç”±æ—¶æ‰åŠ è½½ç›¸åº”çš„æ¨¡å—ï¼Œä»è€Œå‡å°‘åˆå§‹åŠ è½½æ—¶é—´
3. **ä½¿ç”¨è½»é‡çº§ç®¡é“**ï¼šå°½é‡ä½¿ç”¨çº¯ç®¡é“ï¼ˆpure pipesï¼‰ï¼Œé¿å…å¤æ‚çš„è®¡ç®—é€»è¾‘ï¼Œè¿™æ ·å¯ä»¥å‡å°‘ä¸å¿…è¦çš„æ¸²æŸ“å·¥ä½œ
4. **å¯ç”¨ç”Ÿäº§æ¨¡å¼**ï¼šç¡®ä¿åœ¨ç”Ÿäº§ç¯å¢ƒä¸­å¯ç”¨äº† AOT ç¼–è¯‘å’Œç”Ÿäº§æ¨¡å¼ï¼Œè¿™å°†ç§»é™¤è°ƒè¯•ä¿¡æ¯å¹¶æœ€å°åŒ–ä»£ç ä½“ç§¯
5. **ä¼˜åŒ–ç»„ä»¶çš„æ¸²æŸ“æ€§èƒ½**ï¼šæ¯”å¦‚ä½¿ç”¨ `trackBy` å‡½æ•°å¸®åŠ© `ngFor` æå‡åˆ—è¡¨æ¸²æŸ“æ•ˆç‡
6. **ä½¿ç”¨è™šæ‹Ÿæ»šåŠ¨æŠ€æœ¯**ï¼šå½“å¤„ç†å¤§é‡æ•°æ®æ—¶ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨è™šæ‹Ÿæ»šåŠ¨æŠ€æœ¯ï¼Œåªæ¸²æŸ“å¯è§çš„éƒ¨åˆ†å†…å®¹ï¼Œä»¥æå‡æ»šåŠ¨æ€§èƒ½
7. **å…¶ä»–ä¼˜åŒ–æ‰‹æ®µ**ï¼šè¿˜åŒ…æ‹¬ç´¢å¼•æœ¯ã€å‹ç¼©æœ¯ã€ç¼“å­˜æœ¯ã€é¢„å–æœ¯ç­‰é€šç”¨çš„æ€§èƒ½ä¼˜åŒ–æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•ä¸ä»…é€‚ç”¨äºåç«¯å¼€å‘ï¼Œä¹Ÿå¯ä»¥åº”ç”¨äºå‰ç«¯åœºæ™¯

#### ä¼˜åŒ– Angular åº”ç”¨çš„ SEO

ä¸ºäº†ä¼˜åŒ– Angular åº”ç”¨çš„ SEOï¼Œä½ å¯ä»¥é‡‡å–ä»¥ä¸‹å‡ ç§æ–¹æ³•ï¼š

1. **æœåŠ¡å™¨ç«¯æ¸²æŸ“ (SSR)**ï¼šä½¿ç”¨ Angular Universal æ¥å®ç°æœåŠ¡ç«¯æ¸²æŸ“ã€‚è¿™ä½¿å¾—æœç´¢å¼•æ“çˆ¬è™«å¯ä»¥ç›´æ¥è·å–åˆ°é¡µé¢çš„å†…å®¹ï¼Œè€Œä¸æ˜¯ä¾èµ– JavaScript æ¸²æŸ“
2. **é¢„æ¸²æŸ“**ï¼šå¯¹äºé™æ€å†…å®¹ï¼Œå¯ä»¥è€ƒè™‘é¢„æ¸²æŸ“æŠ€æœ¯ï¼Œå¦‚ Scully æˆ–è€… prerender.ioï¼Œå®ƒä»¬å¯ä»¥åœ¨æ„å»ºæ—¶ç”Ÿæˆé™æ€ HTML æ–‡ä»¶
3. **Meta æ ‡ç­¾ç®¡ç†**ï¼šåŠ¨æ€è®¾ç½® meta æ ‡ç­¾æ˜¯æé«˜ SEO çš„ä¸€ä¸ªé‡è¦æ–¹é¢ã€‚å¯ä»¥é€šè¿‡ Angular çš„ Meta æœåŠ¡æ¥åŠ¨æ€åœ°è®¾ç½® titleã€description ç­‰ meta æ ‡ç­¾
4. **Stateful URLs** å’Œ **Configurable URLs**ï¼šç¡®ä¿ URL æ˜¯æœ‰æ„ä¹‰ä¸”æ˜“äºç†è§£çš„ï¼Œå¹¶ä¸”èƒ½å¤Ÿå‡†ç¡®åæ˜ é¡µé¢çš„å†…å®¹ã€‚åŒæ—¶é¿å…ä½¿ç”¨å“ˆå¸Œæ¨¡å¼ï¼ˆhash modeï¼‰ï¼Œé™¤éå¿…è¦ï¼Œå› ä¸ºè¿™ä¼šå½±å“ SEO
5. **æ€§èƒ½ä¼˜åŒ–**ï¼šåŒ…æ‹¬å‡å°‘åŠ è½½æ—¶é—´ã€æ‡’åŠ è½½æ¨¡å—ã€ä»£ç åˆ†å‰²ç­‰ã€‚æ›´å¿«çš„åŠ è½½é€Ÿåº¦æœ‰åŠ©äºæå‡ç”¨æˆ·ä½“éªŒï¼Œé—´æ¥å½±å“ SEO æ’å

## ä¼˜åŒ– **Angular é¡¹ç›®çš„æ„å»ºé€Ÿåº¦**&#x20;

#### **Angular å‘½ä»¤ä¸ç¼–è¯‘æ¨¡å¼**

* `ng serve` é»˜è®¤ä½¿ç”¨ JITï¼ˆå¼€å‘ç¯å¢ƒï¼‰ã€‚
* `ng build --prod` é»˜è®¤ä½¿ç”¨ AOTï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰ã€‚
* å¯é€šè¿‡ `--aot` æ ‡å¿—å¼ºåˆ¶å¯ç”¨ AOTï¼ˆå¦‚ `ng serve --aot`ï¼‰ã€‚

### **å¯ç”¨ AOTï¼ˆAhead-of-Timeï¼‰ç¼–è¯‘ï¼ˆé»˜è®¤ï¼‰**

### **ä½¿ç”¨ Ivy ä»¥å‡å°‘æ„å»ºæ—¶é—´ ï¼ˆé»˜è®¤ï¼‰**

**Ivy** æ˜¯ Angular çš„æ–°ç¼–è¯‘å™¨ï¼Œæä¾›äº†æ›´å¿«çš„æ„å»ºæ—¶é—´å’Œæ›´å°çš„ Bundle ä½“ç§¯ã€‚

### æ„å»ºç¼“å­˜ï¼ˆé»˜è®¤å¯ç”¨ï¼‰

å½“å¼€å‘è€…è¿è¡Œæ„å»ºå‘½ä»¤ï¼ˆå¦‚ `ng build` æˆ– `ng serve`ï¼‰æ—¶ï¼ŒAngular CLI ä¼šæ£€æŸ¥æ˜¯å¦æœ‰å¯ç”¨çš„ç¼“å­˜ã€‚å¦‚æœå­˜åœ¨æœ‰æ•ˆçš„ç¼“å­˜ï¼Œåˆ™ä¼šä½¿ç”¨è¿™äº›ç¼“å­˜æ¥åŠ å¿«æ„å»ºè¿‡ç¨‹ã€‚æŒä¹…åŒ–çš„æ„å»ºç¼“å­˜æ˜¯ä¸€ç§å°†æ„å»ºç»“æœå­˜å‚¨åœ¨ç£ç›˜ä¸Šçš„åŠŸèƒ½ï¼Œå…·ä½“æ¥è¯´æ˜¯åœ¨ `.angular/cache` æ–‡ä»¶å¤¹ä¸‹

#### ç¼“å­˜çš„å†…å®¹

ç¼“å­˜çš„å†…å®¹éå¸¸å¹¿æ³›ï¼ŒåŒ…æ‹¬ä½†ä¸é™äº Babel è½¬æ¢çš„ç»“æœã€å‹ç¼©åçš„ CSS å’Œ JS çš„ç»“æœã€æ„å»ºä¾èµ–é¡¹åŠå…¶è§£æã€æ¨¡å—è½¬æ¢çš„ç»“æœç­‰

### &#x20;**å¯ç”¨å¢é‡æ„å»º**

**Angular 13+** ç‰ˆæœ¬æ”¯æŒ **å¢é‡ç¼–è¯‘**ï¼Œé¿å…é‡å¤ç¼–è¯‘æœªæ›´æ”¹çš„ä»£ç ã€‚\
å¢é‡ç¼–è¯‘ï¼ˆ**Watch Mode**ï¼‰å…è®¸ Angular åœ¨ä»£ç å˜æ›´æ—¶ **ä»…é‡æ–°ç¼–è¯‘ä¿®æ”¹çš„éƒ¨åˆ†**ï¼ŒåŠ å¿«æ„å»ºé€Ÿåº¦ã€‚\
åœ¨ Angular ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹å¼å¯ç”¨ **å¢é‡ç¼–è¯‘æ¨¡å¼**ã€‚

#### **ğŸ”¹ æ–¹å¼ 1ï¼šä½¿ç”¨ `ng build --watch`**

```sh
ng build --watch
```

* **ä½œç”¨**ï¼šç›‘å¬æ–‡ä»¶å˜åŒ–ï¼Œå¹¶åœ¨ä¿®æ”¹ä»£ç æ—¶ **è‡ªåŠ¨å¢é‡ç¼–è¯‘**ã€‚
* **é€‚ç”¨åœºæ™¯**ï¼šå¦‚æœä½ çš„åº”ç”¨éœ€è¦ **ä¸æ–­è¿›è¡Œæ„å»º**ï¼ˆå¦‚ SSR æˆ–ä¸åå°ç³»ç»Ÿé›†æˆï¼‰ã€‚
* **é»˜è®¤ä½¿ç”¨ AOT ç¼–è¯‘**ï¼ˆå¯é€šè¿‡ `--aot=false` å…³é—­ï¼‰ã€‚

#### **`ng build å’Œ ng build --watch`**

* **`ng build`**ï¼šé€‚ç”¨äºéœ€è¦è¿›è¡Œä¸€æ¬¡æ€§æ„å»ºçš„åœºæ™¯ï¼Œä¾‹å¦‚å‡†å¤‡å°†åº”ç”¨éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒæ—¶ã€‚åœ¨éƒ¨ç½²å‰ï¼Œä½¿ç”¨ `ng build --configuration=production` è¿›è¡Œç”Ÿäº§ç¯å¢ƒçš„æ„å»ºï¼Œç”Ÿæˆä¼˜åŒ–åçš„é™æ€æ–‡ä»¶ï¼Œç„¶åå°†è¿™äº›æ–‡ä»¶éƒ¨ç½²åˆ°æœåŠ¡å™¨ä¸Šã€‚
* **`ng build --watch`**ï¼šä¸»è¦ç”¨äºå¼€å‘è¿‡ç¨‹ä¸­ã€‚åœ¨å¼€å‘æ–°åŠŸèƒ½ã€ä¿®å¤ bug æˆ–è¿›è¡Œä»£ç è°ƒè¯•æ—¶ï¼Œå¼€å‘è€…å¯ä»¥ä½¿ç”¨è¯¥å‘½ä»¤ï¼Œå®æ—¶çœ‹åˆ°ä»£ç ä¿®æ”¹åçš„æ•ˆæœã€‚å®ƒä¸æœ¬åœ°å¼€å‘æœåŠ¡å™¨ï¼ˆå¦‚ `ng serve`ï¼‰é…åˆä½¿ç”¨æ•ˆæœæ›´ä½³ï¼Œå½“æ–‡ä»¶å˜åŒ–æ—¶ï¼ŒæœåŠ¡å™¨ä¼šæ£€æµ‹åˆ°æ„å»ºç»“æœçš„æ›´æ–°å¹¶è‡ªåŠ¨åˆ·æ–°æµè§ˆå™¨ï¼Œå®ç°å®æ—¶é¢„è§ˆã€‚

#### **ğŸ”¹ æ–¹å¼ 2ï¼šä½¿ç”¨ `ng serve`ï¼ˆæ¨èå¼€å‘æ¨¡å¼ï¼‰**&#x20;

#### `ng serve` ä¸ä»…å¯åŠ¨äº†æœ¬åœ°å¼€å‘æœåŠ¡å™¨ï¼Œè¿˜é»˜è®¤åŒ…å«äº†æ–‡ä»¶ç›‘æ§å’Œå¢é‡æ„å»ºçš„åŠŸèƒ½

**é€‚ç”¨äºæœ¬åœ°å¼€å‘ï¼ˆJIT æ¨¡å¼ + HMRï¼‰**

```sh
ng serve
```

* **ä½œç”¨**ï¼šåœ¨ **å¼€å‘æœåŠ¡å™¨æ¨¡å¼** ä¸‹ç›‘å¬æ–‡ä»¶å˜åŒ–ï¼Œå¹¶è‡ªåŠ¨ **é‡æ–°ç¼–è¯‘ + åˆ·æ–°é¡µé¢**ã€‚
*   **é»˜è®¤ä½¿ç”¨ JITï¼ˆJust-In-Timeï¼‰ç¼–è¯‘**ï¼Œä½†å¯ä»¥å¯ç”¨ AOTï¼š

    ```sh
    ng serve --aot
    ```
*   **å¦‚æœå¯ç”¨ HMRï¼ˆçƒ­æ¨¡å—æ›¿æ¢ï¼‰ï¼Œåªæ›´æ–°å˜æ›´çš„æ¨¡å—ï¼Œè€Œä¸åˆ·æ–°æ•´ä¸ªé¡µé¢**ï¼š

    ```sh
    ng serve --hmr
    ```

#### **`angular.json` è‡ªå®šä¹‰ Watch Mode**

å¯ä»¥åœ¨ `angular.json` çš„ `build` é€‰é¡¹ä¸­å¯ç”¨ `watch`ï¼š

```json
"projects": {
  "my-angular-app": {
    "architect": {
      "build": {
        "options": {
          "watch": true
        }
      }
    }
  }
}
```

ç„¶åæ‰§è¡Œï¼š

```sh
ng build
```

æ­¤æ—¶ Angular ä¼š**é»˜è®¤å¼€å¯ Watch Mode**ï¼Œæ— éœ€æ‰‹åŠ¨æ·»åŠ  `--watch` é€‰é¡¹ã€‚

### **ä»£ç åˆ†å‰²ï¼ˆLazy Loading & Differential Loadingï¼‰**

âœ… **æ¨¡å—çº§ Lazy Loading**ï¼š

```typescript
const routes: Routes = [
  { path: 'dashboard', loadChildren: () => import('./dashboard/dashboard.module').then(m => m.DashboardModule) }
];
```

### **ä¼˜åŒ–ä¾èµ–é¡¹**

âœ… **ç§»é™¤ä¸å¿…è¦çš„ä¾èµ–**ï¼š

```sh
npm prune
```

`npm prune` ä¸»è¦ç”¨äº **æ¸…ç† `node_modules` ç›®å½•**ï¼Œåˆ é™¤ `package.json` å’Œ `package-lock.json` ä¸­ **æœªåˆ—å‡ºçš„ä¾èµ–**ã€‚

```sh
npm prune --production
```

**åªä¿ç•™ `dependencies`ï¼Œåˆ é™¤ `devDependencies`**ï¼ˆé€‚ç”¨äºç”Ÿäº§ç¯å¢ƒï¼‰ã€‚

| å‘½ä»¤           | ä½œç”¨                                              | é€‚ç”¨åœºæ™¯                     |
| ------------ | ----------------------------------------------- | ------------------------ |
| `npm prune`  | åˆ é™¤ `node_modules` é‡Œä¸éœ€è¦çš„ä¾èµ–                       | **æ¸…ç†æ— ç”¨ä¾èµ–**               |
| `npm ci`     | å½»åº•åˆ é™¤ `node_modules` å¹¶æŒ‰ `package-lock.json` é‡æ–°å®‰è£… | **CI/CDã€å¹²å‡€å®‰è£…**           |
| `npm dedupe` | å»é‡ `node_modules` é‡Œçš„é‡å¤ä¾èµ–                        | **ä¼˜åŒ– `node_modules` ä½“ç§¯** |

### **ç”Ÿäº§ç¯å¢ƒæ„å»ºä¼˜åŒ–**

åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨ `ng build --configuration=production`&#x20;

å¼€å¯ `sourceMap=false` ä»¥å‡å°‘æ„å»ºæ—¶é—´

```json
"configurations": {
  "production": {
    "optimization": true,
    "sourceMap": false,
    "extractCss": true,
    "namedChunks": false,
    "aot": true
  }
}
```

* å¯ç”¨ **AOTï¼ˆAhead-of-Timeï¼‰ç¼–è¯‘**
* **å¯ç”¨ `optimization`ï¼ˆä»£ç å‹ç¼©ã€æ··æ·†ï¼‰**
* **å¯ç”¨ `buildOptimizer`ï¼ˆæ„å»ºä¼˜åŒ–ï¼‰**
* **ç§»é™¤ `console.log` ç­‰è°ƒè¯•ä»£ç **
* **Tree-shaking**ï¼ˆåˆ é™¤æœªä½¿ç”¨çš„ä»£ç ï¼‰
* **ç¦ç”¨ source map**ï¼ˆé»˜è®¤ï¼‰

### **ä»£ç ä¼˜åŒ–**

å‡å°‘ä¸å¿…è¦çš„ `Change Detection`ï¼Œä½¿ç”¨ `ChangeDetectionStrategy.OnPush`&#x20;

é¿å…è¿‡å¤š `ngIf`ï¼Œä½¿ç”¨ `hidden` æˆ– `ng-container`&#x20;

åˆç†ä½¿ç”¨ `trackBy` ä¼˜åŒ– `*ngFor`



## **Angular CLI çš„ Webpack é…ç½®**

Angular CLI ä½¿ç”¨ **Webpack å†…éƒ¨é…ç½®**ï¼Œé€šå¸¸å¼€å‘è€…æ— éœ€ä¿®æ”¹ã€‚ä½†ä½ å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼ **è‡ªå®šä¹‰ Webpack é…ç½®**ï¼š**æ‹“å±•**åŸæœ‰çš„Webpacké…ç½®ã€‚

**ä½¿ç”¨ `angular.json` é…ç½®ï¼š**

åœ¨ `angular.json` æ–‡ä»¶ä¸­ï¼Œä½ å¯ä»¥ä¿®æ”¹æ„å»ºé€‰é¡¹ï¼Œä¾‹å¦‚ï¼š

* è®¾ç½® `optimization`ã€`sourceMap` ç­‰é€‰é¡¹
* é…ç½®æ–‡ä»¶è¾“å‡ºè·¯å¾„

**è‡ªå®šä¹‰ Webpack é…ç½®ï¼š**

å¦‚æœéœ€è¦æ›´ç»†ç²’åº¦çš„æ§åˆ¶ï¼Œå¯ä»¥é€šè¿‡è‡ªå®šä¹‰ Webpack é…ç½®ï¼Œé…åˆ `@angular-builders/custom-webpack` å®ç°ï¼š

```sh
npm install @angular-builders/custom-webpack --save-dev
```

ç„¶ååœ¨ `angular.json` ä¸­ä¿®æ”¹æ„å»ºé…ç½®ï¼š

```json
{
  "builder": "@angular-builders/custom-webpack:browser",
  "options": {
    "webpackConfig": "./webpack.config.js"
  }
}
```

```
module.exports = {
  plugins: [
    // è‡ªå®šä¹‰æ’ä»¶
  ],
  module: {
    rules: [
      // è‡ªå®šä¹‰æ¨¡å—è§„åˆ™
    ]
  }
};
```

è¿™ä¸ªé…ç½®å°†ä¼šä¸é»˜è®¤çš„Angular CLI Webpacké…ç½®åˆå¹¶ï¼Œä»è€Œå…è®¸ä½ æ·»åŠ é¢å¤–çš„åŠ è½½å™¨ã€æ’ä»¶ç­‰ã€‚
